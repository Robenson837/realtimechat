<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>VigiChat - Mensajer√≠a Avanzada</title>
    <!-- FontAwesome with local fallback -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
          onerror="this.onerror=null;this.href='icons-fallback.css';">
    <noscript><link rel="stylesheet" href="icons-fallback.css"></noscript>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/responsive-optimized.css">
    <link rel="stylesheet" href="css/language-selector.css">
    <link rel="stylesheet" href="css/menu-language.css">
    <link rel="stylesheet" href="css/verification.css">
    <meta name="theme-color" content="#4f46e5">
    <meta name="description" content="VigiChat - Aplicaci√≥n de mensajer√≠a avanzada con funciones de vigilancia y tiempo real">
    <meta name="keywords" content="chat, mensajer√≠a, vigilancia, tiempo real, seguridad">
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="apple-touch-icon" href="icons/icon.svg">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">
                <i class="fas fa-comments pulse-icon"></i>
                <span class="fade-in-text">VigiChat</span>
            </div>
            <div class="loading-spinner enhanced-spinner"></div>
            <p class="loading-text fade-in-delayed" data-i18n="loading.connecting">Conectando...</p>
            <div class="loading-dots">
                <span></span><span></span><span></span>
            </div>
        </div>
    </div>

    <!-- Auth Container -->
    <div id="auth-container" class="auth-container hidden">
        <!-- Login Form -->
        <div id="login-form" class="auth-form slide-in">
            <div class="auth-header">
                <div class="logo hover-lift">
                    <i class="fas fa-comments icon-bounce"></i>
                    <span data-i18n="app_name">VigiChat</span>
                </div>
                <h2 class="title-animate" data-i18n="auth.welcome_back">Bienvenido de vuelta</h2>
                <p class="subtitle-animate" data-i18n="auth.login_subtitle">Inicia sesi√≥n para continuar con tus conversaciones</p>
            </div>
            <form id="login-form-element">
                <div class="form-group">
                    <input type="email" id="login-email" data-i18n-placeholder="auth.email_placeholder" placeholder="Correo electr√≥nico" required>
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="form-group">
                    <input type="password" id="login-password" data-i18n-placeholder="auth.password_placeholder" placeholder="Contrase√±a" required>
                    <i class="fas fa-lock"></i>
                    <button type="button" class="password-toggle" data-target="login-password" data-i18n-title="auth.show_password" title="Mostrar contrase√±a">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <button type="submit" class="auth-button btn-enhanced">
                    <span data-i18n="auth.login_button">Iniciar Sesi√≥n</span>
                    <i class="fas fa-arrow-right icon-slide"></i>
                </button>
            </form>
            
            <!-- Alternative Auth Methods -->
            <div class="auth-alternatives">
                <div class="divider">
                    <span data-i18n="auth.or">o</span>
                </div>
                <div class="alt-auth-buttons">
                    <button type="button" class="alt-auth-btn google-auth-btn" id="google-auth-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="google-logo">
                            <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        <span data-i18n="auth.google_login">Google</span>
                    </button>
                    <button type="button" class="alt-auth-btn magic-link-btn" id="magic-link-btn">
                        <i class="fas fa-key"></i>
                        <span data-i18n="auth.otp_login">Iniciar con OTP</span>
                    </button>
                </div>
            </div>
            
            <div class="auth-footer">
                <p><span data-i18n="auth.no_account">¬øNo tienes cuenta?</span> <a href="#" id="show-register" data-i18n="auth.register_here">Reg√≠strate aqu√≠</a></p>
                <p><a href="#" id="show-forgot-password" data-i18n="auth.forgot_password">¬øOlvidaste tu contrase√±a?</a></p>
            </div>
        </div>

        <!-- Register Form -->
        <div id="register-form" class="auth-form slide-in hidden">
            <div class="auth-header">
                <div class="logo hover-lift">
                    <i class="fas fa-comments icon-bounce"></i>
                    <span data-i18n="app_name">VigiChat</span>
                </div>
                <h2 class="title-animate" data-i18n="auth.create_account">Crear cuenta</h2>
                <p class="subtitle-animate" data-i18n="auth.register_subtitle">√önete a la mejor plataforma de mensajer√≠a</p>
            </div>
            <form id="register-form-element">
                <div class="form-group">
                    <input type="text" id="register-fullname" data-i18n-placeholder="auth.fullname_placeholder" placeholder="Nombre completo" required>
                    <i class="fas fa-user"></i>
                </div>
                <div class="form-group">
                    <input type="email" id="register-email" data-i18n-placeholder="auth.email_placeholder" placeholder="Correo electr√≥nico" required>
                    <i class="fas fa-envelope"></i>
                    <div class="validation-indicator" id="email-validation"></div>
                    <div class="field-error" id="email-error"></div>
                </div>
                <div class="form-group">
                    <input type="password" id="register-password" data-i18n-placeholder="auth.password_min" placeholder="Contrase√±a (m√≠n. 6 caracteres)" required>
                    <i class="fas fa-lock"></i>
                    <button type="button" class="password-toggle" data-target="register-password" data-i18n-title="auth.show_password" title="Mostrar contrase√±a">
                        <i class="fas fa-eye"></i>
                    </button>
                    <div class="password-strength" id="password-strength">
                        <div class="strength-bar"></div>
                        <span class="strength-text"></span>
                    </div>
                </div>
                <button type="submit" class="auth-button btn-enhanced">
                    <span data-i18n="auth.create_button">Crear Cuenta</span>
                    <i class="fas fa-user-plus icon-pulse"></i>
                </button>
            </form>
            <div class="auth-footer">
                <p><span data-i18n="auth.have_account">¬øYa tienes cuenta?</span> <a href="#" id="show-login" data-i18n="auth.login_here">Inicia sesi√≥n</a></p>
            </div>
        </div>

        <!-- Forgot Password Form -->
        <div id="forgot-password-form" class="auth-form hidden">
            <div class="auth-header">
                <div class="logo">
                    <i class="fas fa-comments"></i>
                    <span data-i18n="app_name">VigiChat</span>
                </div>
                <h2 data-i18n="auth.recover_password">Recuperar contrase√±a</h2>
                <p data-i18n="auth.recover_subtitle">Ingresa tu email y te enviaremos un enlace para restablecer tu contrase√±a</p>
            </div>
            <form id="forgot-password-form-element">
                <div class="form-group">
                    <input type="email" id="forgot-email" data-i18n-placeholder="auth.email_placeholder" placeholder="Correo electr√≥nico" required>
                    <i class="fas fa-envelope"></i>
                </div>
                <button type="submit" class="auth-button">
                    <span data-i18n="auth.send_link">Enviar enlace</span>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </form>
            <div class="auth-footer">
                <p><a href="#" id="back-to-login" data-i18n="auth.back_to_login">‚Üê Volver al inicio de sesi√≥n</a></p>
            </div>
        </div>

        <!-- Reset Password Form -->
        <div id="reset-password-form" class="auth-form hidden">
            <div class="auth-header">
                <div class="logo">
                    <i class="fas fa-comments"></i>
                    <span data-i18n="app_name">VigiChat</span>
                </div>
                <h2 data-i18n="auth.new_password">Nueva contrase√±a</h2>
                <p data-i18n="auth.new_password_subtitle">Ingresa tu nueva contrase√±a</p>
            </div>
            <form id="reset-password-form-element">
                                <div class="form-group">
                                    <div class="password-flex-group">
                                        <div class="input-row">
                                            <i class="fas fa-lock"></i>
                                            <input type="password" id="new-password" data-i18n-placeholder="auth.new_password_placeholder" placeholder="Nueva contrase√±a (m√≠n. 6 caracteres)" required>
                                            <button type="button" class="password-toggle" data-target="new-password" data-i18n-title="auth.show_password" title="Mostrar contrase√±a">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div class="password-strength" id="new-password-strength">
                                            <div class="strength-bar"></div>
                                            <span class="strength-text"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="password-flex-group">
                                        <div class="input-row">
                                            <i class="fas fa-lock"></i>
                                            <input type="password" id="confirm-password" data-i18n-placeholder="auth.confirm_password_placeholder" placeholder="Confirmar nueva contrase√±a" required>
                                            <button type="button" class="password-toggle" data-target="confirm-password" data-i18n-title="auth.show_password" title="Mostrar contrase√±a">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div class="password-match" id="password-match">
                                            <i class="fas fa-check-circle"></i>
                                            <span data-i18n="auth.passwords_match">Las contrase√±as coinciden</span>
                                        </div>
                                    </div>
                                </div>
                <button type="submit" class="auth-button">
                    <span data-i18n="auth.reset_password_button">Restablecer contrase√±a</span>
                    <i class="fas fa-check"></i>
                </button>
            </form>
        </div>

        <!-- Password Reset Success -->
        <div id="password-reset-success" class="auth-form hidden">
            <div class="auth-header">
                <div class="logo">
                    <i class="fas fa-comments"></i>
                    <span data-i18n="app_name">VigiChat</span>
                </div>
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h2 data-i18n="auth.password_updated">¬°Contrase√±a actualizada!</h2>
                <p data-i18n="auth.password_success_subtitle">Tu contrase√±a ha sido restablecida exitosamente</p>
            </div>
            <button class="auth-button" id="return-to-login">
                <span data-i18n="auth.return_login">Iniciar sesi√≥n</span>
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>

        <!-- Magic Link Form -->
        <div id="magic-link-form" class="auth-form hidden">
            <div class="auth-header">
                <div class="logo">
                    <i class="fas fa-comments"></i>
                    <span data-i18n="app_name">VigiChat</span>
                </div>
                <h2 data-i18n="auth.otp_title">Iniciar con OTP</h2>
                <p data-i18n="auth.otp_subtitle">Ingresa tu correo y te enviaremos un c√≥digo OTP para iniciar sesi√≥n sin contrase√±a</p>
            </div>
            <form id="magic-link-form-element">
                <div class="form-group">
                    <input type="email" id="magic-link-email" data-i18n-placeholder="auth.email_placeholder" placeholder="Correo electr√≥nico" required>
                    <i class="fas fa-envelope"></i>
                </div>
                <button type="submit" class="auth-button">
                    <span data-i18n="auth.send_otp">Enviar OTP</span>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </form>
            <div class="auth-footer">
                <p><a href="#" id="back-to-login-from-magic" data-i18n="auth.back_to_login_magic">‚Üê Volver al inicio de sesi√≥n</a></p>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app-container" class="app-container hidden fade-in-app">
        <!-- Mobile Header -->
        <header class="mobile-header" id="mobile-header">
            <div class="mobile-header-left">
                <div class="mobile-logo">
                    <div class="logo-container">
                        <i class="fas fa-comments"></i>
                        <span class="logo-text" data-i18n="app_name">VigiChat</span>
                    </div>
                </div>
            </div>
            <div class="mobile-header-right">
                <div class="mobile-user-profile" id="mobile-current-user-profile">
                    <div class="mobile-profile-img-container">
                        <img src="images/user-placeholder-40.svg" alt="Tu perfil" class="mobile-profile-img" id="mobile-current-user-profile-img">
                        <div class="mobile-online-indicator" id="mobile-current-user-online-indicator"></div>
                    </div>
                </div>
                <div class="mobile-sidebar-actions">
                    <div class="mobile-main-menu-container">
                        <button class="mobile-icon-btn mobile-main-menu-btn" id="mobile-menu-btn" data-i18n-title="mobile.menu" title="Men√∫ principal">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div class="mobile-main-menu-dropdown hidden" id="mobile-menu-dropdown">
                            <div class="menu-item" id="mobile-profile-settings">
                                <i class="fas fa-user-cog"></i>
                                <span data-i18n="main_menu.profile_settings">Ajustes de perfil</span>
                            </div>
                            <div class="menu-item" id="mobile-add-contact-menu">
                                <i class="fas fa-user-plus"></i>
                                <span data-i18n="main_menu.add_contact">Agregar contacto</span>
                            </div>
                            <div class="menu-item" id="mobile-blocked-contacts-menu">
                                <i class="fas fa-ban"></i>
                                <span data-i18n="main_menu.blocked_contacts">Contactos bloqueados</span>
                            </div>
                            <div class="menu-item" id="mobile-language-menu">
                                <i class="fas fa-globe"></i>
                                <span data-i18n="main_menu.language">Idioma</span>
                                <div class="current-language-indicator">
                                    <img id="mobile-current-language-flag" src="https://flagcdn.com/16x12/es.png" alt="ES" class="current-flag">
                                </div>
                            </div>
                            <div class="menu-item" id="mobile-help-menu">
                                <i class="fas fa-question-circle"></i>
                                <span data-i18n="main_menu.help">Ayuda</span>
                            </div>
                            <div class="menu-divider"></div>
                            <div class="menu-item" id="mobile-logout-menu">
                                <i class="fas fa-sign-out-alt"></i>
                                <span data-i18n="main_menu.logout">Cerrar sesi√≥n</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="logo-container">
                        <i class="fas fa-comments"></i>
                        <span class="logo-text">VigiChat</span>
                    </div>
                </div>
                <div class="user-profile" id="current-user-profile">
                    <!-- √çcono de notificaci√≥n a la izquierda del perfil -->
                    <div class="notification-icon-container" id="notification-container">
                        <button class="icon-btn notification-btn" id="notification-btn" title="Notificaciones">
                            <i class="fas fa-bell"></i>
                            <div class="global-unread-badge hidden" id="global-unread-badge">
                                <span class="global-unread-count" id="global-unread-count">0</span>
                            </div>
                        </button>
                    </div>
                    
                    <div class="profile-img-container">
                        <img src="images/user-placeholder-40.svg" alt="Tu perfil" class="profile-img" id="current-user-profile-img">
                        <div class="online-indicator" id="current-user-online-indicator"></div>
                    </div>
                </div>
                <div class="sidebar-actions">
                    <div class="main-menu-container">
                        <button class="icon-btn main-menu-btn" id="main-menu-btn" title="Men√∫ principal">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div class="main-menu-dropdown hidden" id="main-menu-dropdown">
                            <div class="menu-item" id="profile-settings">
                                <i class="fas fa-user-cog"></i>
                                <span data-i18n="main_menu.profile_settings">Ajustes de perfil</span>
                            </div>
                            <div class="menu-item" id="add-contact-menu">
                                <i class="fas fa-user-plus"></i>
                                <span data-i18n="main_menu.add_contact">Agregar contacto</span>
                            </div>
                            <div class="menu-item" id="blocked-contacts-menu">
                                <i class="fas fa-ban"></i>
                                <span data-i18n="main_menu.blocked_contacts">Contactos bloqueados</span>
                            </div>
                            <div class="menu-item" id="language-menu">
                                <i class="fas fa-globe"></i>
                                <span data-i18n="main_menu.language">Idioma</span>
                                <div class="current-language-indicator">
                                    <img id="current-language-flag" src="https://flagcdn.com/16x12/es.png" alt="ES" class="current-flag">
                                </div>
                            </div>
                            <div class="menu-item" id="help-menu">
                                <i class="fas fa-question-circle"></i>
                                <span data-i18n="main_menu.help">Ayuda</span>
                            </div>
                            <div class="menu-divider"></div>
                            <div class="menu-item" id="logout-menu">
                                <i class="fas fa-sign-out-alt"></i>
                                <span data-i18n="main_menu.logout">Cerrar sesi√≥n</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Tabs -->
            <div class="chat-tabs">
                <button class="tab-button active" data-tab="chats">
                    <span data-i18n="sidebar.chats">Chats</span>
                    <div class="unread-badge hidden" id="chats-unread"></div>
                </button>
                <button class="tab-button" data-tab="contacts">
                    <span data-i18n="sidebar.contacts">Contactos</span>
                </button>
                <button class="tab-button" data-tab="requests">
                    <span data-i18n="sidebar.requests">Solicitudes</span>
                    <div class="unread-badge hidden" id="requests-unread"></div>
                </button>
                <button class="tab-button" data-tab="calls">
                    <span data-i18n="sidebar.calls">Llamadas</span>
                </button>
            </div>

            <!-- Search -->
            <div class="search-container" id="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="chat-search" data-i18n-placeholder="sidebar.search_chats" placeholder="Buscar chats..." autocomplete="off">
                <button class="clear-search hidden" id="clear-search">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Chat Lists -->
            <div class="chat-content">
                <!-- Chats List -->
                <div class="tab-content active" id="chats-tab">
                    <div class="chat-list scrollable-area" id="chat-list">
                        <!-- Chat items will be populated here -->
                    </div>
                </div>

                <!-- Contacts List -->
                <div class="tab-content" id="contacts-tab">
                    <div class="contacts-header">
                        <div class="contacts-search-row">
                            <div class="contacts-search-container">
                                <i class="fas fa-search"></i>
                                <input type="text" id="contacts-search" data-i18n-placeholder="sidebar.search_contacts" placeholder="Buscar contactos..." autocomplete="off">
                            </div>
                            <button class="add-contact-btn-small" id="add-contact-btn" data-i18n-title="sidebar.add_contact">
                                <i class="fas fa-user-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="contacts-list scrollable-area" id="contacts-list">
                        <!-- Contacts will be populated here -->
                    </div>
                </div>

                <!-- Requests List -->
                <div class="tab-content" id="requests-tab">
                    <div class="requests-list scrollable-area" id="requests-list">
                        <!-- Contact requests will be populated here -->
                    </div>
                </div>

                <!-- Calls List -->
                <div class="tab-content" id="calls-tab">
                    <div class="calls-header">
                        <div class="calls-stats">
                            <div class="stat-item">
                                <i class="fas fa-phone-alt"></i>
                                <span data-i18n="sidebar.recent_calls">Llamadas recientes</span>
                            </div>
                        </div>
                    </div>
                    <div class="calls-list scrollable-area" id="calls-list">
                        <!-- Recent calls will be populated here -->
                        <div class="empty-calls-state">
                            <i class="fas fa-phone-slash"></i>
                            <h4 data-i18n="sidebar.no_recent_calls">No hay llamadas recientes</h4>
                            <p data-i18n="sidebar.calls_description">Las llamadas que realices o recibas aparecer√°n aqu√≠</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-area" id="chat-area">
            <!-- Welcome Screen -->
            <div class="welcome-screen" id="welcome-screen">
                <div class="welcome-content">
                    <div class="welcome-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h2 data-i18n="welcome.title">Bienvenido a VigiChat</h2>
                    <p data-i18n="welcome.subtitle">Selecciona un chat para comenzar a conversar</p>
                    <div class="feature-list">
                        <div class="feature-item">
                            <i class="fas fa-shield-alt"></i>
                            <span data-i18n="welcome.encrypted_messages">Mensajes cifrados</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-bolt"></i>
                            <span data-i18n="welcome.real_time">Tiempo real</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-heart"></i>
                            <span data-i18n="welcome.reactions">Reacciones</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Header -->
            <header class="chat-header hidden" id="chat-header">
                <button class="back-btn" id="back-btn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="contact-info" id="contact-info">
                    <div class="contact-avatar-container">
                        <img src="images/user-placeholder-40.svg" alt="Contact" class="contact-avatar">
                    </div>
                    <div class="contact-details">
                        <h3 class="contact-name">Contacto</h3>
                        <div class="contact-status">
                            <div class="typing-indicator hidden" id="typing-indicator">
                                <span>escribiendo...</span>
                                <div class="typing-dots">
                                    <span></span><span></span><span></span>
                                </div>
                            </div>
                            <span class="last-seen" id="last-seen">√öltima vez hace 5 min</span>
                        </div>
                    </div>
                </div>
                <div class="chat-actions">
                    <!-- Search input container for conversation search -->
                    <div class="conversation-search-container" id="conversation-search-container">
                        <div class="conversation-search-input-wrapper">
                            <input type="text" id="conversation-search-input" placeholder="Buscar mensajes..." autocomplete="off">
                            <div class="conversation-search-results-info" id="conversation-search-results-info"></div>
                            <div class="conversation-search-navigation">
                                <button class="conversation-search-nav-btn" id="conversation-search-prev-btn" title="Resultado anterior">
                                    <i class="fas fa-chevron-up"></i>
                                </button>
                                <button class="conversation-search-nav-btn" id="conversation-search-next-btn" title="Siguiente resultado">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                        <button class="conversation-search-close-btn" id="conversation-search-close-btn" title="Cerrar b√∫squeda">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <button class="icon-btn" id="search-btn" title="Buscar en chat">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="icon-btn" id="call-btn" title="Llamar">
                        <i class="fas fa-phone"></i>
                    </button>
                    <button class="icon-btn" id="video-btn" title="Videollamada">
                        <i class="fas fa-video"></i>
                    </button>
                </div>
                <!-- Botones de acci√≥n solo para m√≥vil -->
                <div class="mobile-chat-actions">
                    <button class="icon-btn mobile-search-btn" id="search-messages-mobile-btn" title="Buscar en mensajes">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="icon-btn mobile-call-btn" id="call-mobile-btn" title="Llamar">
                        <i class="fas fa-phone"></i>
                    </button>
                    <button class="icon-btn mobile-video-btn" id="video-mobile-btn" title="Videollamada">
                        <i class="fas fa-video"></i>
                    </button>
                </div>
            </header>

            <!-- Conversation Search Bar (Mobile) -->
            <div class="conversation-search-mobile" id="conversation-search-mobile">
                <div class="conversation-search-input-wrapper">
                    <input type="text" id="conversation-search-input-mobile" placeholder="Buscar mensajes..." autocomplete="off">
                    <div class="conversation-search-results-info" id="conversation-search-results-info-mobile"></div>
                    <div class="conversation-search-navigation">
                        <button class="conversation-search-nav-btn" id="conversation-search-prev-btn-mobile" title="Resultado anterior">
                            <i class="fas fa-chevron-up"></i>
                        </button>
                        <button class="conversation-search-nav-btn" id="conversation-search-next-btn-mobile" title="Siguiente resultado">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
                <button class="conversation-search-close-btn" id="conversation-search-close-btn-mobile" title="Cerrar b√∫squeda">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Messages Container -->
            <div class="messages-container scrollable-area hidden" id="messages-container">
                <div class="messages-wrapper">
                    <div class="messages-scroll scrollable-area" id="messages-scroll">
                        <!-- Messages will be populated here -->
                    </div>
                </div>
                <div class="scroll-to-bottom hidden" id="scroll-to-bottom">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>

            <!-- Message Input -->
            <div class="message-input-container hidden" id="message-input-container">
                <div class="reply-preview hidden" id="reply-preview">
                    <div class="reply-content">
                        <div class="reply-header">
                            <span>Respondiendo a</span>
                            <button class="close-reply" id="close-reply">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="reply-message"></div>
                    </div>
                </div>

                <div class="input-area">
                    <button class="attach-btn" id="attach-btn" data-i18n-title="chat.attachments" title="Adjuntos">
                        <i class="fas fa-plus"></i>
                    </button>
                    <div class="message-input-wrapper">
                        <div class="input-field" id="message-input" contenteditable="true" data-i18n-placeholder="chat.type_message" data-placeholder="Escribe un mensaje..."></div>
                    </div>
                    <button class="send-btn" id="send-btn" data-i18n-title="chat.send" disabled>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                    <button class="record-btn hidden" id="record-btn" data-i18n-title="chat.record_voice" title="Grabar mensaje de voz">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>

                <!-- Emoji Picker -->
                <div class="emoji-picker hidden" id="emoji-picker">
                    <div class="emoji-categories">
                        <button class="emoji-category active" data-category="smileys">üòÄ</button>
                        <button class="emoji-category" data-category="people">üë•</button>
                        <button class="emoji-category" data-category="nature">üå∏</button>
                        <button class="emoji-category" data-category="food">üçé</button>
                        <button class="emoji-category" data-category="activities">‚öΩ</button>
                        <button class="emoji-category" data-category="travel">‚úàÔ∏è</button>
                        <button class="emoji-category" data-category="objects">üíé</button>
                        <button class="emoji-category" data-category="symbols">‚ù§Ô∏è</button>
                    </div>
                    <div class="emoji-grid" id="emoji-grid">
                        <!-- Emojis will be populated here -->
                    </div>
                </div>
            </div>
        </main>

        <!-- Mobile Bottom Navigation -->
        <nav class="mobile-bottom-nav" id="mobile-bottom-nav">
            <button class="nav-tab active" data-tab="chats" id="mobile-nav-chats">
                <i class="fas fa-comment-dots"></i>
                <span>Chat</span>
                <div class="nav-badge hidden" id="mobile-chats-badge"></div>
            </button>
            <button class="nav-tab" data-tab="contacts" id="mobile-nav-contacts">
                <i class="fas fa-address-book"></i>
                <span>Contactos</span>
            </button>
            <button class="nav-tab" data-tab="requests" id="mobile-nav-requests">
                <i class="fas fa-user-plus"></i>
                <span>Solicitudes</span>
                <div class="nav-badge hidden" id="mobile-requests-badge"></div>
            </button>
            <button class="nav-tab" data-tab="calls" id="mobile-nav-calls">
                <i class="fas fa-phone"></i>
                <span>Llamadas</span>
            </button>
        </nav>
    </div>

    <!-- Modals -->
    <!-- Add Contact Modal -->
    <div id="add-contact-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="modal.add_contact_title">Agregar contacto</h3>
                <button class="close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="add-contact-form">
                    <div class="form-group">
                        <label data-i18n="modal.search_user">Buscar usuario:</label>
                        <input type="text" id="contact-search" data-i18n-placeholder="modal.username_or_email" placeholder="Nombre de usuario o correo">
                    </div>
                    <div class="search-results" id="contact-search-results">
                        <!-- Search results will appear here -->
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" data-close-modal data-i18n="modal.cancel">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content large">
            <div class="modal-header">
                <h3 data-i18n="modal.settings_title">Configuraci√≥n</h3>
                <button class="close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="profile">
                        <i class="fas fa-user"></i>
                        <span data-i18n="modal.profile_tab">Perfil</span>
                    </button>
                    <button class="settings-tab" data-tab="privacy">
                        <i class="fas fa-shield-alt"></i>
                        <span data-i18n="modal.privacy_tab">Privacidad</span>
                    </button>
                    <button class="settings-tab" data-tab="notifications">
                        <i class="fas fa-bell"></i>
                        <span data-i18n="modal.notifications_tab">Notificaciones</span>
                    </button>
                    <button class="settings-tab" data-tab="appearance">
                        <i class="fas fa-palette"></i>
                        <span>Apariencia</span>
                    </button>
                </div>
                <div class="settings-content">
                    <!-- Settings tabs content will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container">
        <!-- Notifications will be added here -->
    </div>

    <!-- Context Menu -->
    <div id="context-menu" class="context-menu hidden">
        <!-- Context menu items will be populated dynamically -->
    </div>

    <!-- Profile Photo Viewer Modal -->
    <div id="profile-photo-modal" class="modal photo-modal hidden">
        <div class="modal-overlay" id="photo-modal-overlay"></div>
        <div class="photo-modal-content">
            <div class="photo-modal-header">
                <div class="photo-user-info">
                    <h3 id="photo-modal-name">Nombre del Usuario</h3>
                    <span id="photo-modal-status">En l√≠nea</span>
                </div>
                <button class="close-photo-modal" id="close-photo-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="photo-modal-body">
                <img id="photo-modal-image" src="" alt="Foto de perfil">
                <div class="photo-modal-actions-enhanced" id="photo-modal-actions" style="display: none;">
                    <button class="photo-action-btn-enhanced" id="photo-modal-change-btn" title="Actualizar foto de perfil">
                        <i class="fas fa-camera"></i>
                        <span>Actualizar</span>
                    </button>
                    <button class="photo-action-btn-enhanced delete-action" id="photo-modal-delete-btn" title="Eliminar foto de perfil">
                        <i class="fas fa-trash-alt"></i>
                        <span>Eliminar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Blocked Contacts Modal -->
    <div id="blocked-contacts-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Contactos bloqueados</h3>
                <button class="close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="blocked-contacts-list" id="blocked-contacts-list">
                    <div class="loading-state hidden" id="blocked-loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Cargando contactos bloqueados...</span>
                    </div>
                    <div class="empty-blocked-state" id="empty-blocked-state">
                        <i class="fas fa-ban"></i>
                        <h4>No has bloqueado a ning√∫n contacto</h4>
                        <p>Los contactos que bloquees aparecer√°n aqu√≠</p>
                    </div>
                    <!-- Blocked contacts will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Full Profile Viewer Modal -->
    <div id="full-profile-modal" class="modal profile-modal hidden">
        <div class="modal-overlay" id="profile-modal-overlay"></div>
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h3>Perfil de Usuario</h3>
                <button class="close-profile-modal" id="close-profile-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="profile-modal-body">
                <!-- Profile Photo Section -->
                <div class="profile-photo-section">
                    <div class="profile-photo-container">
                        <img id="profile-modal-image" src="" alt="Foto de perfil" class="profile-large-image">
                        <button class="expand-photo-btn" id="expand-photo-from-profile" title="Ver foto completa">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                    <div class="profile-photo-actions" id="profile-photo-actions" style="display: none;">
                        <button class="photo-action-link" id="change-photo-btn" title="Cambiar foto de perfil">
                            <i class="fas fa-camera"></i>
                            Cambiar
                        </button>
                        <button class="photo-action-link delete-action" id="delete-photo-btn" title="Eliminar foto de perfil">
                            <i class="fas fa-trash-alt"></i>
                            Eliminar
                        </button>
                    </div>
                </div>

                <!-- Profile Info Section -->
                <div class="profile-info-section">
                    <div class="profile-basic-info">
                        <div class="profile-name-section">
                            <h2 id="profile-modal-name">Nombre del Usuario</h2>
                            <div class="profile-quick-actions">
                                <button class="quick-action-btn" id="quick-message-btn" title="Enviar mensaje">
                                    <i class="fas fa-comment"></i>
                                </button>
                                <button class="quick-action-btn" id="quick-call-btn" title="Llamar">
                                    <i class="fas fa-phone"></i>
                                </button>
                                <button class="quick-action-btn" id="quick-video-btn" title="Videollamada">
                                    <i class="fas fa-video"></i>
                                </button>
                            </div>
                        </div>
                        <p id="profile-modal-username">@username</p>
                        <div class="profile-status-info">
                            <div class="status-indicator" id="profile-modal-status-indicator"></div>
                            <span id="profile-modal-status">En l√≠nea</span>
                            <span class="status-separator">‚Ä¢</span>
                            <span id="profile-modal-last-seen">√öltima vez hace 5 min</span>
                        </div>
                    </div>

                    <div class="profile-details">
                        <div class="profile-field-readonly">
                            <div class="field-label">
                                <i class="fas fa-user"></i>
                                <span>Nombre completo</span>
                            </div>
                            <div class="field-content">
                                <span class="field-value" id="profile-modal-full-name">Nombre Completo</span>
                            </div>
                        </div>

                        <div class="profile-field-readonly">
                            <div class="field-label">
                                <i class="fas fa-at"></i>
                                <span>Usuario</span>
                            </div>
                            <div class="field-content">
                                <span class="field-value" id="profile-modal-username-detail">@username</span>
                            </div>
                        </div>
                        
                        <div class="profile-field-readonly">
                            <div class="field-label">
                                <i class="fas fa-envelope"></i>
                                <span>Correo electr√≥nico</span>
                            </div>
                            <div class="field-content">
                                <span class="field-value" id="profile-modal-email">email@example.com</span>
                            </div>
                        </div>
                        
                        <div class="profile-field-readonly">
                            <div class="field-label">
                                <i class="fas fa-info-circle"></i>
                                <span>Bio</span>
                            </div>
                            <div class="field-content">
                                <span class="field-value" id="profile-modal-bio">Sin biograf√≠a disponible</span>
                            </div>
                        </div>

                        <div class="profile-field-readonly">
                            <div class="field-label">
                                <i class="fas fa-clock"></i>
                                <span>√öltima conexi√≥n</span>
                            </div>
                            <div class="field-content">
                                <span class="field-value" id="profile-modal-last-connection">Hace 5 minutos</span>
                            </div>
                        </div>

                        <div class="profile-field-readonly">
                            <div class="field-label">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Miembro desde</span>
                            </div>
                            <div class="field-content">
                                <span class="field-value" id="profile-modal-member-since">Enero 2024</span>
                            </div>
                        </div>
                    </div>

                    <!-- Shared Files Section -->
                    <div class="shared-content">
                        <div class="shared-section">
                            <div class="section-header">
                                <h4><i class="fas fa-file"></i> Archivos compartidos</h4>
                                <button class="view-all-btn" id="view-all-files">Ver todo</button>
                            </div>
                            <div class="shared-files-list" id="shared-files-list">
                                <!-- Shared files will be populated here from real data -->
                                <div class="file-placeholder">
                                    <i class="fas fa-folder-open"></i>
                                    <span>No hay archivos compartidos</span>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Contact Actions -->
                    <div class="contact-actions">
                        <button class="contact-action-btn" id="block-user-btn">
                            <i class="fas fa-ban"></i>
                            <span>Bloquear</span>
                        </button>
                        <button class="contact-action-btn" id="remove-contact-btn">
                            <i class="fas fa-user-minus"></i>
                            <span>Eliminar contacto</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Simple Photo Crop Container -->
    <div id="photo-crop-modal" class="photo-crop-container hidden">
        <div class="crop-header">
            <h3>Editar foto</h3>
            <button class="close-crop" id="close-crop-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="crop-content">
            <!-- Preview and crop area -->
            <div class="crop-preview">
                <canvas id="crop-canvas" class="crop-canvas-simple"></canvas>
                <div class="crop-overlay">
                    <div class="crop-area" id="crop-area">
                        <div class="crop-handle top-left"></div>
                        <div class="crop-handle top-right"></div>
                        <div class="crop-handle bottom-left"></div>
                        <div class="crop-handle bottom-right"></div>
                    </div>
                </div>
            </div>
            
            <!-- Simple preview -->
            <div class="simple-preview">
                <canvas id="preview-canvas" class="preview-canvas-simple"></canvas>
                <p class="preview-label">Vista previa</p>
            </div>
            
            <!-- Basic controls -->
            <div class="basic-controls">
                <div class="control-row">
                    <label>Brillo</label>
                    <input type="range" id="brightness-slider" class="simple-slider" min="0.5" max="2" step="0.1" value="1">
                    <span id="brightness-value">100%</span>
                </div>
                <div class="control-row">
                    <label>Zoom</label>
                    <input type="range" id="zoom-slider" class="simple-slider" min="1" max="3" step="0.1" value="1">
                    <span id="zoom-value">1.0x</span>
                </div>
            </div>
        </div>
        
        <div class="crop-actions">
            <button class="btn-simple btn-auto" id="auto-center-btn">
                <i class="fas fa-bullseye"></i>
                Auto-enfocar
            </button>
            <button class="btn-simple btn-save" id="save-cropped-photo-btn">
                <i class="fas fa-check"></i>
                Guardar
            </button>
        </div>
    </div>

    <!-- File Input Hidden -->
    <input type="file" id="photo-input" accept="image/*" style="display: none;">

    <!-- Delete Photo Confirmation Modal -->
    <div id="delete-photo-confirmation-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content confirmation-modal-content">
            <div class="confirmation-header">
                <div class="confirmation-icon delete-icon">
                    <i class="fas fa-trash-alt"></i>
                </div>
                <h3>Eliminar foto de perfil</h3>
            </div>
            
            <div class="confirmation-body">
                <p>¬øEst√°s seguro de que quieres eliminar tu foto de perfil?</p>
                <p class="confirmation-details">Esta acci√≥n no se puede deshacer. Tu foto actual ser√° eliminada permanentemente.</p>
            </div>
            
            <div class="confirmation-footer">
                <button class="btn-secondary" id="cancel-delete-photo">
                    <i class="fas fa-times"></i>
                    Cancelar
                </button>
                <button class="btn-danger" id="confirm-delete-photo">
                    <i class="fas fa-trash-alt"></i>
                    Eliminar foto
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmation-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content confirmation-modal-content">
            <div class="confirmation-header">
                <div class="confirmation-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 id="confirmation-title">Confirmar acci√≥n</h3>
            </div>
            
            <div class="confirmation-body">
                <p id="confirmation-message">¬øEst√°s seguro de que quieres realizar esta acci√≥n?</p>
                <p id="confirmation-details" class="confirmation-details hidden"></p>
            </div>
            
            <div class="confirmation-actions">
                <button id="confirmation-cancel" class="btn btn-secondary">Cancelar</button>
                <button id="confirmation-confirm" class="btn btn-danger">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Device Verification Modal -->
    <div id="device-verification-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content device-verification-content">
            <div class="verification-header">
                <div class="verification-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h3>Verificaci√≥n de dispositivo</h3>
            </div>
            
            <div class="verification-body">
                <p class="verification-message">
                    Est√°s accediendo desde un dispositivo no reconocido. 
                    Por seguridad, confirma tu identidad para continuar.
                </p>
                
                <form id="device-verification-form">
                    <div class="form-group">
                        <label for="verify-email">Correo electr√≥nico</label>
                        <input type="email" id="verify-email" placeholder="Ingresa tu correo" required>
                        <i class="fas fa-envelope"></i>
                    </div>
                    
                    <div class="form-group">
                        <label for="verify-password">Contrase√±a</label>
                        <div class="input-wrapper">
                            <input type="password" id="verify-password" placeholder="Confirma tu contrase√±a" required>
                            <i class="fas fa-lock"></i>
                            <button type="button" class="password-toggle" data-target="verify-password" title="Mostrar contrase√±a">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="verification-actions">
                <button type="button" class="btn-secondary" id="cancel-verification">
                    <i class="fas fa-times"></i>
                    Cancelar
                </button>
                <button type="button" class="btn-primary" id="confirm-verification">
                    <i class="fas fa-check-shield"></i>
                    Verificar dispositivo
                </button>
            </div>
        </div>
    </div>

    <!-- User Profile Settings Modal -->
    <div id="user-profile-settings-modal" class="modal user-profile-modal hidden">
        <div class="modal-overlay"></div>
        <div class="user-profile-modal-content">
            <div class="user-profile-modal-header">
                <div class="profile-header-icon">
                    <i class="fas fa-user-cog"></i>
                </div>
                <h3>Mi Perfil</h3>
                <button class="close-user-profile-modal" id="close-user-profile-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="user-profile-modal-body">
                <!-- Profile Photo Section -->
                <div class="profile-photo-section">
                    <div class="profile-photo-display">
                        <img id="user-profile-avatar" src="" alt="Tu foto de perfil" class="profile-avatar">
                        <div class="avatar-overlay">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                        <button class="expand-photo-btn" id="user-profile-avatar" title="Ver foto completa">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                    </div>
                </div>

                <!-- Profile Information -->
                <div class="profile-information">
                    <!-- Full Name -->
                    <div class="profile-field-editable">
                        <div class="field-label">
                            <i class="fas fa-user"></i>
                            <span>Nombre completo</span>
                        </div>
                        <div class="field-content">
                            <span class="field-value" id="user-fullname-display">Cargando...</span>
                            <button class="edit-field-btn" data-field="fullName">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                        </div>
                        <div class="field-edit hidden" id="edit-fullName">
                            <input type="text" class="field-input" id="input-fullName" placeholder="Nombre completo">
                            <div class="field-actions">
                                <button class="save-field-btn" data-field="fullName">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="cancel-field-btn" data-field="fullName">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="profile-field-editable">
                        <div class="field-label">
                            <i class="fas fa-envelope"></i>
                            <span>Correo electr√≥nico</span>
                        </div>
                        <div class="field-content">
                            <span class="field-value" id="user-email-display">Cargando...</span>
                            <button class="edit-field-btn" data-field="email">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                        </div>
                        <div class="field-edit hidden" id="edit-email">
                            <input type="email" class="field-input" id="input-email" placeholder="correo@ejemplo.com">
                            <div class="field-actions">
                                <button class="save-field-btn" data-field="email">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="cancel-field-btn" data-field="email">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Username -->
                    <div class="profile-field-editable">
                        <div class="field-label">
                            <i class="fas fa-at"></i>
                            <span>Nombre de usuario</span>
                        </div>
                        <div class="field-content">
                            <span class="field-value" id="user-username-display">Cargando...</span>
                            <button class="edit-field-btn" data-field="username">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                        </div>
                        <div class="field-edit hidden" id="edit-username">
                            <input type="text" class="field-input" id="input-username" placeholder="usuario123">
                            <div class="field-actions">
                                <button class="save-field-btn" data-field="username">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="cancel-field-btn" data-field="username">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Status Message -->
                    <div class="profile-field-editable">
                        <div class="field-label">
                            <i class="fas fa-comment-dots"></i>
                            <span>Mensaje de estado</span>
                        </div>
                        <div class="field-content">
                            <span class="field-value" id="user-statusmessage-display">Sin mensaje de estado</span>
                            <button class="edit-field-btn" data-field="statusMessage">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                        </div>
                        <div class="field-edit hidden" id="edit-statusMessage">
                            <input type="text" class="field-input" id="input-statusMessage" placeholder="¬øC√≥mo te sientes hoy?" maxlength="100">
                            <div class="field-actions">
                                <button class="save-field-btn" data-field="statusMessage">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="cancel-field-btn" data-field="statusMessage">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Non-editable fields -->
                    <div class="profile-field-readonly">
                        <div class="field-label">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Miembro desde</span>
                        </div>
                        <div class="field-content">
                            <span class="field-value" id="user-joined-display">Cargando...</span>
                        </div>
                    </div>

                    <div class="profile-field-readonly">
                        <div class="field-label">
                            <i class="fas fa-clock"></i>
                            <span>√öltima actividad</span>
                        </div>
                        <div class="field-content">
                            <span class="field-value" id="user-lastactivity-display">En l√≠nea ahora</span>
                        </div>
                    </div>

                    <div class="profile-field-readonly">
                        <div class="field-label">
                            <i class="fas fa-circle-dot"></i>
                            <span>Estado actual</span>
                        </div>
                        <div class="field-content">
                            <span class="field-value" id="user-currentstatus-display">
                                <div class="status-indicator online"></div>
                                En l√≠nea
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="user-profile-modal-footer">
                    <button class="btn-secondary" id="close-profile-modal-btn">
                        <i class="fas fa-times"></i>
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Forward Message Modal -->
    <div id="forward-message-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content forward-modal">
            <div class="modal-header">
                <h3><i class="fas fa-share"></i> Reenviar mensaje</h3>
                <button class="close-modal" id="close-forward-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Message Preview -->
                <div class="forward-message-preview">
                    <div class="preview-header">
                        <i class="fas fa-comment"></i>
                        <span>Mensaje a reenviar:</span>
                    </div>
                    <div class="preview-content" id="forward-message-content">
                        <!-- Message content will be inserted here -->
                    </div>
                </div>

                <!-- Contact Search -->
                <div class="contact-search-section">
                    <div class="search-header">
                        <i class="fas fa-users"></i>
                        <span>Seleccionar contactos:</span>
                        <div class="select-all-section">
                            <label class="select-all-checkbox">
                                <input type="checkbox" id="select-all-contacts">
                                <span class="checkmark"></span>
                                <span class="select-all-text">Seleccionar todos</span>
                            </label>
                        </div>
                    </div>
                    <div class="search-input-container">
                        <input type="text" id="forward-contact-search" placeholder="Buscar contactos..." autocomplete="off">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>

                <!-- Contacts List -->
                <div class="forward-contacts-container">
                    <div class="forward-contacts-list" id="forward-contacts-list">
                        <!-- Contacts will be loaded here -->
                    </div>
                </div>

                <!-- Selected Contacts -->
                <div class="selected-contacts-section hidden" id="selected-contacts-section">
                    <div class="selected-header">
                        <span>Contactos seleccionados:</span>
                        <button class="clear-selection" id="clear-selection">
                            <i class="fas fa-times"></i> Limpiar
                        </button>
                    </div>
                    <div class="selected-contacts-list" id="selected-contacts-list">
                        <!-- Selected contacts will appear here -->
                    </div>
                </div>
                
                <!-- Additional Message -->
                <div class="forward-additional-message">
                    <div class="additional-message-header">
                        <i class="fas fa-plus-circle"></i>
                        <span>Agregar mensaje (opcional):</span>
                    </div>
                    <div class="additional-message-input-container">
                        <textarea 
                            id="forward-additional-text" 
                            class="additional-message-input" 
                            placeholder="Escribe un mensaje adicional..."
                            maxlength="500"
                            rows="3"></textarea>
                        <div class="character-count">
                            <span id="char-count">0</span>/500
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancel-forward">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn-primary" id="confirm-forward" disabled>
                    <i class="fas fa-paper-plane"></i> Reenviar <span class="forward-count">0</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- ULTRA-FAST MESSAGING SYSTEM SCRIPTS -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/touch-scroll-handler.js"></script>
    <script src="js/welcomeScreenManager.js"></script>
    <script src="js/autoResizeInput.js"></script>
    <script src="js/messageCache.js"></script> <!-- ULTRA-FAST MESSAGE CACHE -->
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <!-- Attachment Modal for Mobile -->
    <div class="attachment-modal-overlay" id="attachment-modal-overlay"></div>
    <div class="attachment-modal" id="attachment-modal">

    <!-- Camera Modal - WhatsApp Style -->
    <div class="whatsapp-camera-overlay" id="camera-modal-overlay">
        <!-- Top Controls -->
        <div class="whatsapp-camera-top">
            <div class="left-controls">
                <button class="whatsapp-close-btn" id="close-camera-btn">
                    <i class="fas fa-times"></i>
                </button>
                <button class="whatsapp-fullscreen-btn" id="fullscreen-camera-btn" title="Pantalla completa">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="whatsapp-flip-btn" id="switch-camera-btn-top" title="Cambiar c√°mara">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            <div class="whatsapp-recording-indicator" id="recording-indicator" style="display: none;">
                <div class="recording-dot"></div>
                <span class="recording-time" id="recording-time">0:00</span>
            </div>
        </div>

        <!-- Camera Video -->
        <video id="camera-video" autoplay playsinline muted class="whatsapp-camera-video"></video>
        <canvas id="camera-canvas" style="display: none;"></canvas>

        <!-- Preview de foto/video capturado -->
        <div class="whatsapp-capture-preview" id="capture-preview" style="display: none;">
            <img id="captured-image" alt="Captura" style="display: none;">
            <video id="captured-video" controls style="display: none; max-width: 100%; max-height: 100%; object-fit: contain;"></video>
            
            <!-- Controles de preview -->
            <div class="whatsapp-preview-controls">
                <button class="whatsapp-preview-btn cancel" id="retake-photo-btn">
                    <i class="fas fa-times"></i>
                </button>
                <button class="whatsapp-preview-btn send" id="save-photo-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- Bottom Controls -->
        <div class="whatsapp-camera-bottom">
            <!-- Gallery Button -->
            <button class="whatsapp-gallery-btn" id="gallery-access-btn">
                <div class="gallery-icon">
                    <i class="fas fa-images"></i>
                </div>
            </button>

            <!-- Capture Button -->
            <div class="whatsapp-capture-container">
                <button class="whatsapp-capture-btn" id="camera-capture-btn">
                    <div class="capture-outer-ring">
                        <div class="capture-inner-circle"></div>
                    </div>
                </button>
            </div>

        </div>
    </div>
        <div class="attachment-options">
            <button class="attachment-option emoji" data-type="emoji">
                <i class="fas fa-smile"></i>
                <span data-i18n="attachment.emojis">Emojis</span>
            </button>
            <button class="attachment-option camera" data-type="camera">
                <i class="fas fa-camera"></i>
                <span data-i18n="attachment.camera">C√°mara</span>
            </button>
            <button class="attachment-option gallery" data-type="gallery">
                <i class="fas fa-images"></i>
                <span data-i18n="attachment.gallery">Galer√≠a</span>
            </button>
            <button class="attachment-option location" data-type="location">
                <i class="fas fa-map-marker-alt"></i>
                <span data-i18n="attachment.location">Ubicaci√≥n</span>
            </button>
            <button class="attachment-option attach-doc-btn mobile-only" id="attach-doc-modal-btn" data-type="document">
                <i class="fas fa-file"></i>
                <span data-i18n="attachment.document">Documento</span>
            </button>
        </div>
    </div>

    <!-- Call Interface -->
    <div class="call-modal" id="call-modal">
        <div class="call-container">
            <!-- Call Header -->
            <div class="call-header">
                <div class="call-contact-info">
                    <div class="call-avatar">
                        <img src="images/user-placeholder-40.svg" alt="Contact" id="call-contact-avatar">
                        <div class="call-status-indicator"></div>
                    </div>
                    <div class="call-details">
                        <h3 class="call-contact-name" id="call-contact-name">Contacto</h3>
                        <p class="call-status" id="call-status" data-i18n="calls.outgoing">Llamando...</p>
                    </div>
                </div>
                <div class="call-duration" id="call-duration">00:00</div>
            </div>

            <!-- Video Container -->
            <div class="call-video-container" id="call-video-container">
                <!-- Remote Video -->
                <video class="remote-video" id="remote-video" autoplay playsinline></video>
                <!-- Local Video (Picture in Picture) -->
                <video class="local-video" id="local-video" autoplay playsinline muted></video>
                
                <!-- Audio Only Display -->
                <div class="audio-call-display" id="audio-call-display">
                    <div class="audio-avatar">
                        <img src="images/user-placeholder-40.svg" alt="Contact" id="audio-contact-avatar">
                        <div class="audio-wave-animation">
                            <div class="wave"></div>
                            <div class="wave"></div>
                            <div class="wave"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Call Controls -->
            <div class="call-controls">
                <div class="call-controls-row">
                    <!-- Mute Audio -->
                    <button class="call-control-btn audio-btn" id="toggle-audio-btn" data-i18n-title="calls.mute" title="Silenciar micr√≥fono">
                        <i class="fas fa-microphone"></i>
                    </button>
                    
                    <!-- Toggle Video -->
                    <button class="call-control-btn video-btn" id="toggle-video-btn" data-i18n-title="calls.video" title="Activar/Desactivar video">
                        <i class="fas fa-video"></i>
                    </button>
                    
                    <!-- Switch Camera -->
                    <button class="call-control-btn switch-btn" id="switch-camera-btn" data-i18n-title="calls.switch_camera" title="Cambiar c√°mara">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    
                    <!-- Speaker -->
                    <button class="call-control-btn speaker-btn" id="toggle-speaker-btn" data-i18n-title="calls.speaker" title="Altavoz">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
                
                <div class="call-action-row">
                    <!-- End Call -->
                    <button class="call-control-btn end-call-btn" id="end-call-btn" data-i18n-title="calls.end" title="Colgar">
                        <i class="fas fa-phone-slash"></i>
                    </button>
                </div>
            </div>

            <!-- Incoming Call Interface -->
            <div class="incoming-call-interface" id="incoming-call-interface">
                <div class="incoming-call-info">
                    <div class="incoming-call-avatar">
                        <img src="images/user-placeholder-40.svg" alt="Contact" id="incoming-contact-avatar">
                    </div>
                    <h3 class="incoming-contact-name" id="incoming-contact-name">Contacto</h3>
                    <p class="incoming-call-type" id="incoming-call-type" data-i18n="calls.incoming">Llamada entrante</p>
                </div>
                
                <div class="incoming-call-actions">
                    <button class="incoming-call-btn decline-btn" id="decline-call-btn">
                        <i class="fas fa-phone-slash"></i>
                    </button>
                    <button class="incoming-call-btn accept-btn" id="accept-call-btn">
                        <i class="fas fa-phone"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <link rel="stylesheet" href="css/camera-animations.css">
    <link rel="stylesheet" href="css/camera-recording.css">
    <link rel="stylesheet" href="css/simple-camera.css">
    <link rel="stylesheet" href="css/document-preview.css">
    
    <script src="js/contacts.js"></script>
    <script src="js/emojiPicker.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/callManager.js"></script>
    <script src="js/callHistory.js"></script>
    <script src="js/callMessagesRenderer.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/socket.js"></script>
    <script src="js/profilePhoto.js"></script>
    <script src="js/profileViewer.js"></script>
    <script src="js/blockedContacts.js"></script>
    <script src="js/mainMenu.js"></script>
    <script src="js/userProfileSettings.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/languageSelector.js"></script>
    <script src="js/i18n-init.js"></script>
    <script src="js/intelligentPhotoCrop.js"></script>
    <script src="js/verificationSystem.js"></script>
    <script src="js/mobileNavigation.js"></script>
    <script src="js/app.js"></script>
    
    
</body>
</html>