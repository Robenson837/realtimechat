/**
 * MESSENGER-EXACT SCROLL IMPLEMENTATION
 * Based on deep research of Facebook Messenger and WhatsApp Web
 * Exact same patterns and techniques used by Meta
 */

/* MESSENGER PATTERN: Container Configuration */
.messages-container,
.messages-scroll,
#messages-scroll {
    /* MESSENGER: Primary scroll properties */
    overflow-y: auto;
    overflow-x: hidden;
    
    /* MESSENGER: Prevent scroll chaining (modern web apps standard) */
    overscroll-behavior: contain;
    overscroll-behavior-y: contain;
    
    /* MESSENGER: Touch control (standard on all modern chat apps) */
    touch-action: pan-y;
    -ms-touch-action: pan-y;
    
    /* MESSENGER: Position-based scroll control (not native scrolling) */
    position: relative;
    
    /* MESSENGER: Full height container */
    height: 100%;
    max-height: 100vh;
    
    /* MESSENGER: Prevent text selection during scroll */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    
    /* MESSENGER: Hardware acceleration for smooth scrolling */
    will-change: scroll-position;
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    
    /* MESSENGER: Disable scroll behavior (manual control) */
    scroll-behavior: auto;
    
    /* MESSENGER: Custom scrollbar styling (WhatsApp Web pattern) */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
}

/* MESSENGER PATTERN: WebKit Scrollbar (WhatsApp Web exact implementation) */
.messages-container::-webkit-scrollbar,
.messages-scroll::-webkit-scrollbar,
#messages-scroll::-webkit-scrollbar {
    width: 6px;
}

.messages-container::-webkit-scrollbar-track,
.messages-scroll::-webkit-scrollbar-track,
#messages-scroll::-webkit-scrollbar-track {
    background: transparent;
}

.messages-container::-webkit-scrollbar-thumb,
.messages-scroll::-webkit-scrollbar-thumb,
#messages-scroll::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 3px;
    min-height: 20px;
}

.messages-container::-webkit-scrollbar-thumb:hover,
.messages-scroll::-webkit-scrollbar-thumb:hover,
#messages-scroll::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.3);
}

/* MESSENGER PATTERN: Mobile Optimizations */
@media screen and (max-width: 768px), (hover: none) and (pointer: coarse) {
    .messages-container,
    .messages-scroll,
    #messages-scroll {
        /* MESSENGER MOBILE: Enable momentum scrolling */
        -webkit-overflow-scrolling: touch;
        
        /* MESSENGER MOBILE: Enhanced touch response */
        touch-action: pan-y;
        -webkit-touch-callout: none;
        
        /* MESSENGER MOBILE: Prevent scroll bounce */
        overscroll-behavior: contain;
        overscroll-behavior-y: contain;
        
        /* MESSENGER MOBILE: Hardware acceleration */
        -webkit-transform: translate3d(0, 0, 0);
        transform: translate3d(0, 0, 0);
        
        /* MESSENGER MOBILE: Better rendering */
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        
        /* MESSENGER MOBILE: Containment for performance */
        contain: layout style paint;
        
        /* MESSENGER MOBILE: Hide scrollbar on mobile */
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    
    .messages-container::-webkit-scrollbar,
    .messages-scroll::-webkit-scrollbar,
    #messages-scroll::-webkit-scrollbar {
        display: none;
        width: 0;
    }
}

/* MESSENGER PATTERN: Message Items Container */
.message {
    /* MESSENGER: Prevent layout shifts */
    contain: layout style;
    
    /* MESSENGER: Allow text selection in messages */
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
    
    /* MESSENGER: Pointer events enabled for messages */
    pointer-events: auto;
    
    /* MESSENGER: Relative positioning for proper stacking */
    position: relative;
}

/* MESSENGER PATTERN: Chat Container Layout */
.chat-container {
    /* MESSENGER: Full viewport height */
    height: 100vh;
    height: 100dvh; /* Dynamic viewport height */
    
    /* MESSENGER: Flexbox layout */
    display: flex;
    flex-direction: column;
    
    /* MESSENGER: Prevent parent scrolling */
    overflow: hidden;
    
    /* MESSENGER: Prevent scroll chaining */
    overscroll-behavior: contain;
}

/* MESSENGER PATTERN: Messages List Container */
.messages-list {
    /* MESSENGER: Flex grow to fill space */
    flex: 1;
    
    /* MESSENGER: Enable scrolling */
    overflow-y: auto;
    overflow-x: hidden;
    
    /* MESSENGER: Position for scroll control */
    position: relative;
    
    /* MESSENGER: Prevent shrinking */
    min-height: 0;
}

/* MESSENGER PATTERN: Input Area (Fixed Bottom) */
.message-input-container,
.chat-input {
    /* MESSENGER: Fixed at bottom */
    position: sticky;
    bottom: 0;
    
    /* MESSENGER: Above messages */
    z-index: 10;
    
    /* MESSENGER: Don't shrink */
    flex-shrink: 0;
    
    /* MESSENGER: Prevent scroll interference */
    overscroll-behavior: contain;
}

/* MESSENGER PATTERN: iOS Safari Specific Fixes */
@supports (-webkit-overflow-scrolling: touch) {
    .messages-container,
    .messages-scroll,
    #messages-scroll {
        /* MESSENGER IOS: Force momentum scrolling */
        -webkit-overflow-scrolling: touch;
        
        /* MESSENGER IOS: Prevent scroll jumping */
        -webkit-transform: translateZ(0);
        
        /* MESSENGER IOS: Better font rendering */
        -webkit-font-smoothing: antialiased;
        
        /* MESSENGER IOS: Fix scroll position issues */
        position: relative;
        z-index: 1;
    }
}

/* MESSENGER PATTERN: Android Chrome Specific */
@media screen and (max-width: 768px) {
    @supports (overscroll-behavior: contain) {
        .messages-container,
        .messages-scroll,
        #messages-scroll {
            /* MESSENGER ANDROID: Modern overscroll control */
            overscroll-behavior-y: contain;
            
            /* MESSENGER ANDROID: Performance optimization */
            will-change: scroll-position;
            
            /* MESSENGER ANDROID: Smooth transforms */
            transform: translate3d(0, 0, 0);
        }
    }
}

/* MESSENGER PATTERN: Prevent Body Scroll (WhatsApp Web technique) */
body {
    /* MESSENGER: Prevent pull-to-refresh */
    overscroll-behavior-y: contain;
    
    /* MESSENGER: Fixed height on mobile */
    height: 100vh;
    height: 100dvh;
    
    /* MESSENGER: Prevent horizontal scroll */
    overflow-x: hidden;
}

html {
    /* MESSENGER: Root scroll control */
    overscroll-behavior: contain;
    
    /* MESSENGER: Full height */
    height: 100%;
}

/* MESSENGER PATTERN: Virtual Scroll Support (Facebook technique) */
.virtual-scroll-container {
    /* MESSENGER: Position-based scrolling */
    position: relative;
    
    /* MESSENGER: Transform control */
    transform: translateY(0);
    transition: transform 0.1s ease-out;
    
    /* MESSENGER: Full width */
    width: 100%;
}

/* MESSENGER PATTERN: Loading States */
.messages-loading {
    /* MESSENGER: Prevent scroll during loading */
    overflow: hidden;
    pointer-events: none;
}

/* MESSENGER PATTERN: High DPI Optimization */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .messages-container,
    .messages-scroll,
    #messages-scroll {
        /* MESSENGER RETINA: Better rendering */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
}

/* MESSENGER PATTERN: Accessibility - Reduced Motion */
@media (prefers-reduced-motion: reduce) {
    .messages-container,
    .messages-scroll,
    #messages-scroll {
        /* MESSENGER A11Y: Disable smooth scrolling */
        scroll-behavior: auto;
        
        /* MESSENGER A11Y: Remove momentum scrolling */
        -webkit-overflow-scrolling: auto;
        
        /* MESSENGER A11Y: Remove transforms */
        transform: none;
        -webkit-transform: none;
    }
}

/* MESSENGER PATTERN: Dark Mode Support (Meta standard) */
@media (prefers-color-scheme: dark) {
    .messages-container::-webkit-scrollbar-thumb,
    .messages-scroll::-webkit-scrollbar-thumb,
    #messages-scroll::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
    }
    
    .messages-container::-webkit-scrollbar-thumb:hover,
    .messages-scroll::-webkit-scrollbar-thumb:hover,
    #messages-scroll::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.3);
    }
}